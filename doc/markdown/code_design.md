# 功能实现的多样性
- 问题：
  - 在设计过程中，我发现一个功能的实现方式是多种多样，举个例子，流媒体推流可以用RTMP、RTSP、WebRTC，目标跟踪可以用deepsort、bytetrack，目标检测可以用yolo、RetinaNet、Faster R-CNN，所以我们不可能新加一种实现方式就改动原来的代码逻辑，这个需要怎么初始化，那个需要传什么参数，我们应该把这些功能的初始化和调用逻辑统一起来。
- 解决方案：
  - 我的设计是这样的，首先在配置文件里面写明每个功能需要哪些参数，然后在初始化的时候，先创建一个工厂对象，然后通过这个工厂对象，将配置信息作为参数传递，功能类内部读取配置信息，从而完成自己的初始化，在实际功能调用的时候，就需要找出不同方法的共同点，把这些共同点提取出来作为参数，这样就可以实现功能的多样性。

# 行人重识别功能
- 问题：
  - 在添加行人重识别功能之前，整个系统的流程是：首先拉取外部的视频流，然后模型管理器通过yolo模型进行目标检测，然后通过reid模型提取到特征向量，然后通过deepsort模型进行目标跟踪，最后将跟踪结果推送到外部的视频流中。
  - 现在考虑添加行人重识别功能，需要在特征提取之后，利用提取到的特征向量对数据库的特征向量进行检索，识别出行人角色（可能是嫌疑人、陌生人等角色），然后向前端反馈检索结果。很明显，这2个功能都使用目标检测和特征提取功能，只不过在后续处理中存在差异，如何能够让系统兼容这2个功能呢？
- 解决方法：
  - 我刚开始想到的方法是在配置文件中添加enable功能字段，用来区分不同的功能；在完成目标检测和特征提取之后，根据这个功能字段和switch语句，转到不同的逻辑中，但是我觉得这个很奇怪，每添加一个新功能就要添加switch来切换功能，switch添加地越来越多，越来越难维护，如果现在要在目标检测和特征提取之间加一个新功能，那么就需要在目标检测和特征提取之间的switch中添加一个新的case，这样就会导致目标检测和特征提取的逻辑变得复杂，难以维护。
  - 同时，目标检测和特征提取是有状态的，所以就不能改成静态方法使用，只能创建不同对象。
  - 然后，我发现目标跟踪其实是不属于模型相关的内容，它只是使用到了模型提供的功能，所以它不应该和模型管理器产生耦合，而应该抽出来作为一个服务类，用于满足不同的业务逻辑
  - 于是，我把目标跟踪单独抽出来作为一个服务类，然后在模型管理器中，只负责模型的初始化和调用，然后在目标跟踪服务类中，负责目标跟踪的初始化和调用，这样就可以实现目标跟踪和模型管理器的解耦。而行人重识别也可以看作是另一个服务，定义服务类即可。
  - 这样的好处在于：把switch判断逻辑从模型管理器中抽出来，统一放到外部类中，使得模型管理器专注于模型的调用，而无需关注实际业务逻辑。